<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>手書き文字収集</title>
	<style>
		#canvas {
			border: 1px solid black;
			background: white;
		}
	</style>
</head>
<body>
	<h1>手書き文字収集</h1>
	<!-- プルダウン -->
	<label>モード: 
    <select id="modeSelect">
      <option value="single">1文字モード</option>
      <option value="random5">ランダムモード</option>
    </select>
  </label>
  <br>

  <!-- 文字選択 -->
  <label>文字: 
    <select id="charSelect"></select>
  </label>
  <br>

	<canvas id="canvas" width="300" height="300"></canvas><br>
	<button id="saveBtn">保存</button>
	<script>
		// ひらがなセット
  const kanaSet = [
    "あ","い","う","え","お","か","き","く","け","こ",
    "さ","し","す","せ","そ","た","ち","つ","て","と",
    "な","に","ぬ","ね","の","は","ひ","ふ","へ","ほ",
    "ま","み","む","め","も","や","ゆ","よ","ら","り",
    "る","れ","ろ","わ","を","ん",
    "ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ",
    "サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト",
    "ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ",
    "マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ",
    "ル","レ","ロ","ワ","ヲ","ン"
  ];
 const modeSelect = document.getElementById("modeSelect");
  const charSelect = document.getElementById("charSelect");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  let drawing = false;
  let strokes = [];
  let currentStroke = [];

  // 位置取得
  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }

  // 描画開始
  function startDrawing(e) {
    drawing = true;
    currentStroke = [];
    strokes.push(currentStroke);

    const { x, y } = getPos(e);
    ctx.beginPath();
    ctx.moveTo(x, y);
    currentStroke.push({ x, y });
  }

  // 描画中
  function draw(e) {
    if (!drawing) return;
    const { x, y } = getPos(e);
    ctx.lineTo(x, y);
    ctx.stroke();
    currentStroke.push({ x, y });
  }

  // 描画終了
  function endDrawing() {
    drawing = false;
  }

  // Pointer Events
  canvas.addEventListener("pointerdown", startDrawing);
  canvas.addEventListener("pointermove", draw);
  canvas.addEventListener("pointerup", endDrawing);
  canvas.addEventListener("pointerleave", endDrawing);

  // ランダムにn個選ぶ関数
  function getRandomChars(n) {
    const shuffled = [...kanaSet].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, n);
  }

  // プルダウン更新
  function updateCharSelect() {
    charSelect.innerHTML = "";
    let chars;
    if (modeSelect.value === "single") {
      chars = kanaSet; // 全文字
    } else {
      chars = getRandomChars(5); // ランダム5文字
    }
    chars.forEach(c => {
      const option = document.createElement("option");
      option.value = c;
      option.textContent = c;
      charSelect.appendChild(option);
    });
  }

  // モード変更で更新
  modeSelect.addEventListener("change", updateCharSelect);

  // 保存ボタン
  document.getElementById("saveBtn").onclick = () => {
    const char = charSelect.value;

    // JSON作成
    const jsonData = JSON.stringify({ char: char, strokes: strokes }, null, 2);
    const blob = new Blob([jsonData], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    // ファイル名
    const now = new Date();
    const timestamp = now.toISOString().replace(/[-:T]/g, "").split(".")[0];
    const filename = `${char}_${timestamp}.json`;

    // ダウンロード
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    a.click();

    // キャンバスリセット
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    strokes = [];

    // 5文字モードなら次の5文字を更新
    if (modeSelect.value === "random5") {
      updateCharSelect();
    }
  };

  // 初期表示
  updateCharSelect();
  </script>
</body>
</html>